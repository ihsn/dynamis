

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1.4. Script 4: Internal Migration &mdash; DYNAMIS-POP  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.5. Script 5: Immigration" href="05_Immigration.html" />
    <link rel="prev" title="1.3. Script 3: Primary Education" href="03_PrimaryEducation.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> DYNAMIS-POP
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="AnalysisInput-Index.html">1. Parameter Generation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_Setup_ABC_2000.html">1.1. Script 1: Country/Version-Specific Setup File</a></li>
<li class="toctree-l2"><a class="reference internal" href="02_CreateStartpop.html">1.2. Script 2: Starting Population</a></li>
<li class="toctree-l2"><a class="reference internal" href="03_PrimaryEducation.html">1.3. Script 3: Primary Education</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">1.4. Script 4: Internal Migration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#file-output">1.4.1. File output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code">1.4.2. Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="05_Immigration.html">1.5. Script 5: Immigration</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_Emigration.html">1.6. Script 6: Emigration</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_FirstMarriage.html">1.7. Script 7: First Marriage</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_FirstBirths.html">1.8. Script 8: First Births</a></li>
<li class="toctree-l2"><a class="reference internal" href="09_HigherBirths.html">1.9. Script 9: Higher Order Births</a></li>
<li class="toctree-l2"><a class="reference internal" href="10_ChildMortality.html">1.10. Script 10: Child Mortality</a></li>
<li class="toctree-l2"><a class="reference internal" href="11_Ethnicity.html">1.11. Script 11: Ethnicity</a></li>
<li class="toctree-l2"><a class="reference internal" href="12_SchoolPlanning.html">1.12. Script 12: School Planning</a></li>
<li class="toctree-l2"><a class="reference internal" href="13_LowerSecondary.html">1.13. Script 13: Lower Secondary Education</a></li>
<li class="toctree-l2"><a class="reference internal" href="14_DemProj.html">1.14. Script 14: Demographic Macro-Projections</a></li>
<li class="toctree-l2"><a class="reference internal" href="15_Settings.html">1.15. Script 15: Model Settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../AnalysisOutput/AnalysisOutput-Index.html">2. Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Model/Model-Index.html">3. Technical Implementation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">DYNAMIS-POP</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="AnalysisInput-Index.html">1. Parameter Generation</a> &raquo;</li>
        
      <li>1.4. Script 4: Internal Migration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/Analysis/AnalysisInput/04_Migration.Rmd.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="script-4-internal-migration">
<span id="script-4-internal-migration"></span><h1>1.4. Script 4: Internal Migration<a class="headerlink" href="#script-4-internal-migration" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div>Internal Migration is modeled calculating origin-destination matrices by age group and sex. For easier parameterization, parameters are split up in probabilities to leave and the distributions of destination by origin. For the probability to leave, two alternative parameters are calculated, one including education as additional dimension.</div></blockquote>
<div class="section" id="file-output">
<span id="file-output"></span><h2>1.4.1. File output<a class="headerlink" href="#file-output" title="Permalink to this headline">¶</a></h2>
<p>The code below generates 3 model parameters stored in a Modgen .dat file</p>
<ul class="simple">
<li>Migration probability by sex, age group and district</li>
<li>Migration probability by eucation, sex, age group and district</li>
<li>Migration Destination by origin, sex, and age group</li>
</ul>
<p><img alt="" src="../../_images/ParaMigration.png" /></p>
</div>
<div class="section" id="code">
<span id="code"></span><h2>1.4.2. Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h2>
<div class="highlight-{r, message=FALSE, warning=FALSE} notranslate"><div class="highlight"><pre><span></span>####################################################################################################
# 
#  DYNAMIS-POP Parameter Generation File 4 - Internal Migration
#  This file is generic and works for all country contexts. 
#  Input file: globals_for_analysis.RData (To generate such a file run the setup script)
#  Last Update: Martin Spielauer 2018-05-12
#
####################################################################################################

####################################################################################################
# Clear work space, load required packages and the input object file
####################################################################################################

rm(list=ls())

library(haven)
library(dplyr)
library(data.table)
library(sp) 
library(maptools)
library(survival)
library(fmsb)
library(eha)


load(file=&quot;globals_for_analysis.RData&quot;)
dat &lt;- g_residents_dat

# Set Parameter Output File
parafile &lt;- file(g_para_migration, &quot;w&quot;)

# Constants
n_maxdist       &lt;- max(dat$M_DOB)

# Add an integer variable for age a year ago
dat$m_ageago &lt;- as.integer(dat$M_AGE)-1

# remove those not born a year ago 
dat &lt;- dat[!(dat$m_ageago&lt;0),]

# Age groups 5 years ago, up to 60+ 
dat$m_agegr5 &lt;- as.integer(dat$m_ageago/5) * 5
dat$m_agegr5[dat$m_agegr5&gt;60] &lt;- 60
  
# Remove those not in the country 12 months ago (previous district was max value of districts)
dat &lt;- dat[dat$M_PDIST&lt;n_maxdist,]

# Person is internal migrant (moved within the country)
dat$is_migrant &lt;- FALSE
dat$is_migrant[dat$M_DOR != dat$M_PDIST] &lt;- TRUE

# Keep only what&#39;s needed
dat &lt;- dat[,c(&quot;M_WEIGHT&quot;, &quot;M_MALE&quot;, &quot;M_EDUC&quot;, &quot;M_DOR&quot;, &quot;M_PDIST&quot;, &quot;m_agegr5&quot;, &quot;is_migrant&quot; )]

####################################################################################################
# Create and append a dataset of all possible migrations for each age group
# This is to avoid empty cells in origin-destination matrices
# The records have very low weights which do not affect overall migration
####################################################################################################

umale &lt;- unique(dat$M_MALE)
udist &lt;- sort(unique(dat$M_DOR))
uage &lt;- sort(unique(dat$m_agegr5))
ueduc &lt;- sort(unique(dat$M_EDUC))
allmigs &lt;- expand.grid(M_MALE=umale, M_DOR=udist, M_PDIST=udist, m_agegr5=uage, M_EDUC=ueduc )
allmigs &lt;- allmigs[allmigs$M_DOR != allmigs$M_PDIST,]
allmigs$M_WEIGHT &lt;- 0.0000001
allmigs$is_migrant &lt;- TRUE
dat &lt;- rbind(dat, allmigs)

####################################################################################################
# Calculate the parameter MigrationProbability[SEX][AGE5_PART][DISTRICT_NAT]                      
####################################################################################################

# Create the parameter for probability of out-migration by sex, age group and province of origin

popall   &lt;- xtabs(dat$M_WEIGHT ~ dat$M_MALE + dat$m_agegr5 + dat$M_PDIST)
migs     &lt;- dat[dat$is_migrant==TRUE,]
popmig   &lt;- xtabs(migs$M_WEIGHT ~ migs$M_MALE + migs$m_agegr5 + migs$M_PDIST)
propmig  &lt;- as.data.frame(popmig/popall)
propmig  &lt;- propmig[order(propmig$migs.M_MALE, propmig$migs.m_agegr5, propmig$migs.M_PDIST),]

####################################################################################################
# Write the parameter MigrationProbability[SEX][AGE5_PART][DISTRICT_NAT] 
####################################################################################################

cat(&quot;parameters { \n  //EN Migration probability \ndouble MigrationProbability[SEX][AGE5_PART][DISTRICT_NAT] = {\n&quot;, file=parafile)
cat(format(round(propmig$Freq,5),scientific=FALSE), file=parafile, sep=&quot;, &quot;, append=TRUE)
cat(&quot;\n}; \n\n&quot;, file=parafile, append=TRUE) 

####################################################################################################
# Calculate the parameter MigrationProbabilityEduc[PRIMARY_LEVEL][SEX][AGE5_PART][DISTRICT_NAT]              
####################################################################################################

popall    &lt;- xtabs(dat$M_WEIGHT ~ dat$M_MALE + dat$m_agegr5 + dat$M_PDIST + dat$M_EDUC)
migs      &lt;- dat[dat$is_migrant==TRUE,]
popmig    &lt;- xtabs(migs$M_WEIGHT ~ migs$M_MALE + migs$m_agegr5 + migs$M_PDIST + migs$M_EDUC)
propmigE  &lt;- as.data.frame(popmig/popall)
# for those below age 10 use the overall rates from above
propmigE  &lt;- propmigE[propmigE$migs.m_agegr5 != &quot;0&quot; &amp; propmigE$migs.m_agegr5 != &quot;5&quot;,]
propmigN  &lt;- propmig[propmig$migs.m_agegr5 == &quot;0&quot; | propmig$migs.m_agegr5 == &quot;5&quot;,]

propmigN1 &lt;- cbind(migs.M_EDUC =&quot;0&quot;,propmigN)
propmigN2 &lt;- cbind(migs.M_EDUC =&quot;1&quot;,propmigN)
propmigN3 &lt;- cbind(migs.M_EDUC =&quot;2&quot;,propmigN)
propmigN  &lt;- rbind(propmigN1, propmigN2, propmigN3)

propmig   &lt;- rbind(propmigE, propmigN)
propmig   &lt;- propmig[order(propmig$migs.M_EDUC, propmig$migs.M_MALE, propmig$migs.m_agegr5, propmig$migs.M_PDIST),]

####################################################################################################
# Write the parameter MigrationProbabilityEduc[PRIMARY_LEVEL][SEX][AGE5_PART][DISTRICT_NAT]
####################################################################################################

cat(&quot;\n\n//EN Migration probability by Education\ndouble MigrationProbabilityEduc[PRIMARY_LEVEL][SEX][AGE5_PART][DISTRICT_NAT] = {\n&quot;, file=parafile, append=TRUE)
cat(format(round(propmig$Freq,5),scientific=FALSE), file=parafile, sep=&quot;, &quot;, append=TRUE)
cat(&quot;\n}; \n\n&quot;, file=parafile, append=TRUE) 

####################################################################################################
# Calculate the parameter cumrate MigrationDestination[SEX][DISTRICT_NAT][AGE5_PART][DISTRICT_NAT]    
####################################################################################################

popmig &lt;- dat[dat$is_migrant==TRUE,]
popmig &lt;- xtabs(popmig$M_WEIGHT ~ popmig$M_MALE + popmig$m_agegr5 + popmig$M_PDIST + popmig$M_DOR)
popmig &lt;- as.data.frame(popmig)

popmig$groupsum  &lt;- ave(popmig$Freq, popmig$popmig.M_MALE, popmig$popmig.m_agegr5, popmig$popmig.M_PDIST,FUN=sum)
popmig$paravalue &lt;- popmig$Freq / popmig$groupsum
popmig           &lt;- popmig[order(popmig$popmig.M_MALE, popmig$popmig.M_PDIST, popmig$popmig.m_agegr5),]

####################################################################################################
# Write the parameter MigrationDestination[SEX][DISTRICT_NAT][AGE5_PART][DISTRICT_NAT]
####################################################################################################

cat(&quot;\n\n//EN Migration Destination\ncumrate MigrationDestination[SEX][DISTRICT_NAT][AGE5_PART][DISTRICT_NAT] = {\n&quot;, file=parafile, append=TRUE)
cat(format(round(popmig$paravalue,10),scientific=FALSE), file=parafile, sep=&quot;, &quot;, append=TRUE)
cat(&quot;\n}; \n};\n&quot;, file=parafile, append=TRUE) 

close(parafile)
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="05_Immigration.html" class="btn btn-neutral float-right" title="1.5. Script 5: Immigration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="03_PrimaryEducation.html" class="btn btn-neutral" title="1.3. Script 3: Primary Education" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Martin Spielauer.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>